<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  test
  <!-- <img src=""> -->
  <img src="https://www.google.com.hk/images/branding/googlelogo/2x/googlelogo_color_272x92dp.png" style="width: 100%;"/>
</body>
<script>
  window.testSendToNative = () => {
    // let arrayBuffer = new ArrayBuffer(4)
    // var view   = new Int32Array(arrayBuffer);
    // view.fill(2)
    const arrayBuffer = (new Uint16Array([1,2,3])).buffer
    // let image = document.querySelector('img')
    // fetch(image.src).then(r => {
    //   return r.arrayBuffer()
    // }).then(arrayBuffer => {
      let payload = {
      test: 33445,
      result: arrayBuffer
    }
    console.log(arrayBuffer, arrayBuffer[0], arrayBuffer[1], arrayBuffer[2])
    // console.log(view, arrayBuffer, arrayBuffer[0], arrayBuffer[1], arrayBuffer[2], arrayBuffer[3])
    window.webkit.messageHandlers.test.postMessage(JSON.stringify(payload))

    // }).catch(err => {
    //   window.webkit.messageHandlers.test.postMessage(`err ${err}`)
    // })
    // .finally(() => {
    //   window.webkit.messageHandlers.test.postMessage("finish")

    // })
    return true
  }
</script>
</html>